---
import Layout from "../../layouts/Layout.astro";
import Banner from "../../components/Banner.astro";
import CourseList, { type Course } from "../../components/CourseList.astro";
import { loadQuery } from "../../sanity/lib/load-query";
import type { SanityDocument } from "@sanity/client";

export const prerender = true;

const categories = ["All Courses", "Web Development", "Data Science", "UI/UX Design", "Digital Marketing"];

const result = await loadQuery<SanityDocument[]>({
  query: `*[_type == "course"]{
    id,
    title,
    provider,
    image,
    rating,
    students,
    duration,
    level,
    tag
  }`,
});

// Log the full result to see what's coming back
console.log("Full result from loadQuery:", result);

const courses = result.data || [];
console.log("Courses after extraction:", courses);
---

<Layout
  title="Courses"
  description="Explore our curated collection of top-rated courses from industry experts."
>
  <main class="container mx-auto px-4 py-20">
    <Banner 
      title="Learn Today, Earn Tomorrow" 
      description="We recommend only the best, most practical courses â€” curated to help you grow faster and start earning sooner."
    />
    
    {courses && courses.length > 0 ? (
      <CourseList courses={courses as unknown as Course[] } categories={categories} />
    ) : (
      <div>
        <p>No courses found. Check the console for debugging information.</p>
      </div>
    )}
  </main>
</Layout>